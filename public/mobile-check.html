<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Verificação de Compatibilidade - Tilapios</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      margin: 0;
      padding: 16px;
      background-color: #f9fafb;
      color: #1f2937;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    h1 {
      color: #2563eb;
      font-size: 1.5rem;
      margin-top: 0;
    }
    h2 {
      color: #1e40af;
      font-size: 1.25rem;
      margin-top: 1.5rem;
    }
    .status {
      padding: 8px 12px;
      border-radius: 4px;
      margin: 8px 0;
      font-weight: 500;
    }
    .success {
      background-color: #d1fae5;
      color: #065f46;
    }
    .warning {
      background-color: #fef3c7;
      color: #92400e;
    }
    .error {
      background-color: #fee2e2;
      color: #b91c1c;
    }
    .info {
      background-color: #dbeafe;
      color: #1e40af;
    }
    button {
      background-color: #2563eb;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 500;
      margin-top: 8px;
    }
    button:hover {
      background-color: #1d4ed8;
    }
    pre {
      background-color: #f3f4f6;
      padding: 12px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 0.875rem;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Verificação de Compatibilidade - Tilapios</h1>
    <p>Esta página verifica se seu dispositivo é compatível com o aplicativo Tilapios e diagnostica possíveis problemas.</p>
    
    <button id="runTests">Executar Verificação</button>
    
    <div id="results" class="hidden">
      <h2>Resultados da Verificação</h2>
      
      <div id="browserCheck" class="status">Verificando navegador...</div>
      <div id="viewportCheck" class="status">Verificando viewport...</div>
      <div id="connectionCheck" class="status">Verificando conexão...</div>
      <div id="storageCheck" class="status">Verificando armazenamento local...</div>
      <div id="firebaseCheck" class="status">Verificando conexão com Firebase...</div>
      
      <h2>Informações do Dispositivo</h2>
      <pre id="deviceInfo"></pre>
      
      <h2>Próximos Passos</h2>
      <div id="recommendations"></div>
    </div>
  </div>

  <script>
    document.getElementById('runTests').addEventListener('click', runDiagnostics);
    
    async function runDiagnostics() {
      document.getElementById('results').classList.remove('hidden');
      
      // Verificar navegador
      checkBrowser();
      
      // Verificar viewport
      checkViewport();
      
      // Verificar conexão
      await checkConnection();
      
      // Verificar armazenamento local
      checkLocalStorage();
      
      // Verificar Firebase (simulado)
      checkFirebase();
      
      // Mostrar informações do dispositivo
      showDeviceInfo();
      
      // Gerar recomendações
      generateRecommendations();
    }
    
    function checkBrowser() {
      const browserElement = document.getElementById('browserCheck');
      const ua = navigator.userAgent;
      let browserName = "Desconhecido";
      let browserVersion = "";
      
      if (ua.indexOf("Chrome") > -1) {
        browserName = "Chrome";
        browserVersion = ua.match(/Chrome\/(\d+\.\d+)/)[1];
      } else if (ua.indexOf("Safari") > -1) {
        browserName = "Safari";
        browserVersion = ua.match(/Version\/(\d+\.\d+)/)?.[1] || "";
      } else if (ua.indexOf("Firefox") > -1) {
        browserName = "Firefox";
        browserVersion = ua.match(/Firefox\/(\d+\.\d+)/)[1];
      } else if (ua.indexOf("Edge") > -1) {
        browserName = "Edge";
        browserVersion = ua.match(/Edge\/(\d+\.\d+)/)?.[1] || "";
      }
      
      const isCompatible = (
        (browserName === "Chrome" && parseFloat(browserVersion) >= 90) ||
        (browserName === "Safari" && parseFloat(browserVersion) >= 14) ||
        (browserName === "Firefox" && parseFloat(browserVersion) >= 88) ||
        (browserName === "Edge" && parseFloat(browserVersion) >= 90)
      );
      
      if (isCompatible) {
        browserElement.className = "status success";
        browserElement.textContent = `✅ Navegador compatível: ${browserName} ${browserVersion}`;
      } else {
        browserElement.className = "status warning";
        browserElement.textContent = `⚠️ Navegador pode não ser totalmente compatível: ${browserName} ${browserVersion}`;
      }
    }
    
    function checkViewport() {
      const viewportElement = document.getElementById('viewportCheck');
      const width = window.innerWidth;
      const height = window.innerHeight;
      
      if (width < 320) {
        viewportElement.className = "status error";
        viewportElement.textContent = `❌ Tela muito pequena: ${width}x${height}px`;
      } else if (width < 375) {
        viewportElement.className = "status warning";
        viewportElement.textContent = `⚠️ Tela pequena, pode haver problemas de layout: ${width}x${height}px`;
      } else {
        viewportElement.className = "status success";
        viewportElement.textContent = `✅ Tamanho de tela adequado: ${width}x${height}px`;
      }
    }
    
    async function checkConnection() {
      const connectionElement = document.getElementById('connectionCheck');
      
      try {
        const startTime = Date.now();
        const response = await fetch('https://www.google.com', { mode: 'no-cors', cache: 'no-store' });
        const endTime = Date.now();
        const latency = endTime - startTime;
        
        if (latency > 1000) {
          connectionElement.className = "status warning";
          connectionElement.textContent = `⚠️ Conexão lenta: ${latency}ms de latência`;
        } else {
          connectionElement.className = "status success";
          connectionElement.textContent = `✅ Conexão estável: ${latency}ms de latência`;
        }
      } catch (error) {
        connectionElement.className = "status error";
        connectionElement.textContent = `❌ Problema de conexão: ${error.message}`;
      }
    }
    
    function checkLocalStorage() {
      const storageElement = document.getElementById('storageCheck');
      
      try {
        localStorage.setItem('tilapios_test', 'test');
        localStorage.removeItem('tilapios_test');
        storageElement.className = "status success";
        storageElement.textContent = `✅ Armazenamento local disponível`;
      } catch (error) {
        storageElement.className = "status error";
        storageElement.textContent = `❌ Armazenamento local indisponível: ${error.message}`;
      }
    }
    
    function checkFirebase() {
      const firebaseElement = document.getElementById('firebaseCheck');
      
      // Simulação de verificação do Firebase
      const domainCheck = window.location.hostname === 'tilapios.vercel.app' || 
                          window.location.hostname === 'localhost';
      
      if (domainCheck) {
        firebaseElement.className = "status info";
        firebaseElement.textContent = `ℹ️ Domínio válido para Firebase: ${window.location.hostname}`;
      } else {
        firebaseElement.className = "status warning";
        firebaseElement.textContent = `⚠️ Domínio não reconhecido: ${window.location.hostname}`;
      }
    }
    
    function showDeviceInfo() {
      const deviceInfoElement = document.getElementById('deviceInfo');
      const info = {
        userAgent: navigator.userAgent,
        platform: navigator.platform,
        vendor: navigator.vendor,
        language: navigator.language,
        cookiesEnabled: navigator.cookieEnabled,
        onLine: navigator.onLine,
        screenResolution: `${window.screen.width}x${window.screen.height}`,
        viewportSize: `${window.innerWidth}x${window.innerHeight}`,
        pixelRatio: window.devicePixelRatio,
        timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone
      };
      
      deviceInfoElement.textContent = JSON.stringify(info, null, 2);
    }
    
    function generateRecommendations() {
      const recommendationsElement = document.getElementById('recommendations');
      const issues = [];
      
      // Verificar problemas identificados
      const browserStatus = document.getElementById('browserCheck').className;
      const viewportStatus = document.getElementById('viewportCheck').className;
      const connectionStatus = document.getElementById('connectionCheck').className;
      const storageStatus = document.getElementById('storageCheck').className;
      
      if (browserStatus.includes('warning') || browserStatus.includes('error')) {
        issues.push('Atualize seu navegador para a versão mais recente.');
      }
      
      if (viewportStatus.includes('warning') || viewportStatus.includes('error')) {
        issues.push('Tente girar o dispositivo para o modo paisagem para melhor visualização.');
      }
      
      if (connectionStatus.includes('warning') || connectionStatus.includes('error')) {
        issues.push('Verifique sua conexão com a internet. Tente usar Wi-Fi se estiver usando dados móveis.');
      }
      
      if (storageStatus.includes('error')) {
        issues.push('Verifique se o modo privado/anônimo está desativado e se os cookies estão permitidos.');
      }
      
      // Adicionar recomendação sobre o Firebase
      issues.push('Certifique-se de que o domínio tilapios.vercel.app está autorizado no Firebase Authentication.');
      
      // Adicionar recomendações gerais
      issues.push('Limpe o cache e os cookies do navegador.');
      issues.push('Tente acessar o site em um navegador diferente.');
      
      // Exibir recomendações
      if (issues.length > 0) {
        const list = document.createElement('ul');
        issues.forEach(issue => {
          const item = document.createElement('li');
          item.textContent = issue;
          list.appendChild(item);
        });
        recommendationsElement.appendChild(list);
      } else {
        recommendationsElement.textContent = 'Seu dispositivo parece estar totalmente compatível com o aplicativo Tilapios.';
      }
      
      // Adicionar link para a documentação
      const docLink = document.createElement('p');
      docLink.innerHTML = 'Para mais informações, consulte o <a href="/MOBILE_TROUBLESHOOTING.md" target="_blank">guia de solução de problemas</a>.';
      recommendationsElement.appendChild(docLink);
    }
  </script>
</body>
</html>