<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tilapios - Ferramenta de Limpeza de Dados</title>
  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
      --danger: #ef4444;
      --danger-dark: #dc2626;
      --success: #10b981;
      --success-dark: #059669;
      --warning: #f59e0b;
      --warning-dark: #d97706;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-300: #d1d5db;
      --gray-700: #374151;
      --gray-800: #1f2937;
      --gray-900: #111827;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      line-height: 1.6;
      color: var(--gray-800);
      background-color: var(--gray-100);
      padding: 20px;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      padding: 24px;
    }

    header {
      display: flex;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--gray-200);
    }

    .logo {
      width: 40px;
      height: 40px;
      margin-right: 12px;
    }

    h1 {
      font-size: 24px;
      color: var(--gray-900);
    }

    .warning-box {
      background-color: #fff5f5;
      border-left: 4px solid var(--danger);
      padding: 16px;
      margin-bottom: 24px;
      border-radius: 4px;
    }

    .warning-title {
      display: flex;
      align-items: center;
      color: var(--danger);
      font-weight: 600;
      margin-bottom: 8px;
    }

    .warning-icon {
      margin-right: 8px;
    }

    .card {
      border: 1px solid var(--gray-200);
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 24px;
    }

    .card-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 12px;
      color: var(--gray-800);
      display: flex;
      align-items: center;
    }

    .card-title svg {
      margin-right: 8px;
    }

    .environment-selector {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .env-option {
      flex: 1;
      padding: 12px;
      border: 2px solid var(--gray-300);
      border-radius: 6px;
      cursor: pointer;
      text-align: center;
      font-weight: 500;
      transition: all 0.2s;
    }

    .env-option.production {
      border-color: var(--danger);
      color: var(--danger);
    }

    .env-option.homologation {
      border-color: var(--warning);
      color: var(--warning);
    }

    .env-option.selected {
      background-color: var(--gray-800);
      color: white;
    }

    .env-option.production.selected {
      background-color: var(--danger);
    }

    .env-option.homologation.selected {
      background-color: var(--warning);
    }

    .collections-list {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 16px;
    }

    .collection-item {
      display: flex;
      align-items: center;
      padding: 8px 12px;
      background-color: var(--gray-100);
      border-radius: 4px;
      font-size: 14px;
    }

    .collection-item svg {
      margin-right: 8px;
      flex-shrink: 0;
    }

    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 16px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: background-color 0.2s;
      border: none;
      font-size: 16px;
    }

    .button svg {
      margin-right: 8px;
    }

    .button-primary {
      background-color: var(--primary);
      color: white;
    }

    .button-primary:hover {
      background-color: var(--primary-dark);
    }

    .button-danger {
      background-color: var(--danger);
      color: white;
    }

    .button-danger:hover {
      background-color: var(--danger-dark);
    }

    .button-success {
      background-color: var(--success);
      color: white;
    }

    .button-success:hover {
      background-color: var(--success-dark);
    }

    .button-warning {
      background-color: var(--warning);
      color: white;
    }

    .button-warning:hover {
      background-color: var(--warning-dark);
    }

    .button-group {
      display: flex;
      gap: 12px;
      margin-top: 24px;
    }

    .confirmation-dialog {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .dialog-content {
      background-color: white;
      border-radius: 8px;
      padding: 24px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .dialog-title {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 16px;
      color: var(--danger);
      display: flex;
      align-items: center;
    }

    .dialog-title svg {
      margin-right: 8px;
    }

    .confirmation-input {
      width: 100%;
      padding: 12px;
      border: 2px solid var(--gray-300);
      border-radius: 6px;
      margin-top: 16px;
      margin-bottom: 24px;
      font-size: 16px;
    }

    .confirmation-input:focus {
      outline: none;
      border-color: var(--primary);
    }

    .dialog-buttons {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
    }

    .output-container {
      margin-top: 24px;
      padding: 16px;
      background-color: var(--gray-900);
      color: white;
      border-radius: 6px;
      font-family: monospace;
      max-height: 300px;
      overflow-y: auto;
    }

    .output-line {
      margin-bottom: 4px;
      line-height: 1.4;
    }

    .output-success {
      color: #34d399;
    }

    .output-error {
      color: #f87171;
    }

    .output-warning {
      color: #fbbf24;
    }

    .output-info {
      color: #60a5fa;
    }

    .hidden {
      display: none;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      margin-top: 16px;
      padding: 12px;
      border-radius: 6px;
      background-color: var(--gray-100);
    }

    .status-indicator svg {
      margin-right: 12px;
      flex-shrink: 0;
    }

    .status-success {
      background-color: #ecfdf5;
      color: var(--success);
    }

    .status-error {
      background-color: #fef2f2;
      color: var(--danger);
    }

    .status-warning {
      background-color: #fffbeb;
      color: var(--warning);
    }

    .status-info {
      background-color: #eff6ff;
      color: var(--primary);
    }

    @media (max-width: 640px) {
      .collections-list {
        grid-template-columns: repeat(2, 1fr);
      }

      .button-group {
        flex-direction: column;
      }

      .button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#3b82f6">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-5-9h10v2H7z"/>
      </svg>
      <h1>Tilapios - Ferramenta de Limpeza de Dados</h1>
    </header>

    <div class="warning-box">
      <div class="warning-title">
        <svg class="warning-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        ATEN√á√ÉO: Opera√ß√£o de Alto Risco
      </div>
      <p>Esta ferramenta ir√° <strong>APAGAR PERMANENTEMENTE</strong> todos os dados do Firebase. Esta a√ß√£o √© <strong>IRREVERS√çVEL</strong> e deve ser usada com extrema cautela.</p>
    </div>

    <div class="card">
      <div class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
        </svg>
        Status de Autentica√ß√£o
      </div>
      <div id="auth-status" class="status-indicator status-warning">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <line x1="12" y1="8" x2="12" y2="12"></line>
          <line x1="12" y1="16" x2="12.01" y2="16"></line>
        </svg>
        <span>Verificando status de autentica√ß√£o...</span>
      </div>
    </div>

    <div class="card">
      <div class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 9v11a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V9"/>
          <path d="M9 22V12h6v10M2 10.6L12 2l10 8.6"/>
        </svg>
        Selecione o Ambiente
      </div>
      <div class="environment-selector">
        <div class="env-option production" data-env="PRODU√á√ÉO">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
          </svg>
          PRODU√á√ÉO
        </div>
        <div class="env-option homologation" data-env="HOMOLOGA√á√ÉO">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
          </svg>
          HOMOLOGA√á√ÉO
        </div>
      </div>

      <div class="card-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M3 3h18v18H3zM8 12h8"/>
          <path d="M12 8v8"/>
        </svg>
        Cole√ß√µes a serem limpas
      </div>
      <div class="collections-list">
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
            <circle cx="9" cy="7" r="4"></circle>
            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
          </svg>
          users
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          posts
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="8" r="7"></circle>
            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
          </svg>
          tournaments
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="8" r="7"></circle>
            <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline>
          </svg>
          fishing_tournaments
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
          </svg>
          fishing_catches
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"></path>
          </svg>
          catches
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
          rankings
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
          comments
        </div>
        <div class="collection-item">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
          likes
        </div>
      </div>

      <div class="button-group">
        <button id="clean-data-btn" class="button button-danger" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
          </svg>
          Limpar Dados
        </button>
        <button id="clear-cache-btn" class="button button-warning">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M23 4v6h-6"/>
            <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"/>
          </svg>
          Limpar Cache Local
        </button>
      </div>
    </div>

    <div id="output-section" class="hidden">
      <div class="card">
        <div class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="4 17 10 11 4 5"></polyline>
            <line x1="12" y1="19" x2="20" y2="19"></line>
          </svg>
          Log de Opera√ß√µes
        </div>
        <div id="output" class="output-container"></div>
      </div>
    </div>
  </div>

  <div id="confirmation-dialog" class="confirmation-dialog">
    <div class="dialog-content">
      <div class="dialog-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
          <line x1="12" y1="9" x2="12" y2="13"></line>
          <line x1="12" y1="17" x2="12.01" y2="17"></line>
        </svg>
        Confirma√ß√£o de Limpeza de Dados
      </div>
      <p>Voc√™ est√° prestes a <strong>APAGAR PERMANENTEMENTE</strong> todos os dados do ambiente <span id="selected-env-display">PRODU√á√ÉO</span>.</p>
      <p>Esta a√ß√£o √© <strong>IRREVERS√çVEL</strong> e todos os dados ser√£o perdidos.</p>
      <p>Para confirmar, digite <strong>CONFIRMAR-<span id="confirm-text">AMBIENTE</span></strong> abaixo:</p>
      <input type="text" id="confirmation-input" class="confirmation-input" placeholder="Digite a confirma√ß√£o...">
      <div class="dialog-buttons">
        <button id="cancel-btn" class="button button-primary">
          Cancelar
        </button>
        <button id="confirm-btn" class="button button-danger" disabled>
          Confirmar Limpeza
        </button>
      </div>
    </div>
  </div>

  <!-- Carregar Firebase (substitua pelos scripts corretos do seu projeto) -->
  <script type="module">
    // Importar Firebase
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js';
    import { getAuth, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js';
    import { getFirestore, collection, query, where, getDocs, doc, deleteDoc, writeBatch } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js';
    import { getStorage, ref, listAll, deleteObject } from 'https://www.gstatic.com/firebasejs/9.22.0/firebase-storage.js';

    // Configura√ß√£o do Firebase (ser√° carregada das vari√°veis de ambiente)
    const firebaseConfig = {
      apiKey: "",
      authDomain: "",
      projectId: "",
      storageBucket: "",
      messagingSenderId: "",
      appId: ""
    };

    // Inicializar Firebase
    let app;
    let auth;
    let db;
    let storage;

    try {
      // Tentar carregar configura√ß√£o do localStorage (se dispon√≠vel)
      const storedConfig = localStorage.getItem('firebaseConfig');
      if (storedConfig) {
        const parsedConfig = JSON.parse(storedConfig);
        Object.keys(parsedConfig).forEach(key => {
          if (parsedConfig[key]) {
            firebaseConfig[key] = parsedConfig[key];
          }
        });
      }

      // Tentar carregar de vari√°veis de ambiente (Vite)
      if (typeof import.meta !== 'undefined' && import.meta.env) {
        if (import.meta.env.VITE_FIREBASE_API_KEY) firebaseConfig.apiKey = import.meta.env.VITE_FIREBASE_API_KEY;
        if (import.meta.env.VITE_FIREBASE_AUTH_DOMAIN) firebaseConfig.authDomain = import.meta.env.VITE_FIREBASE_AUTH_DOMAIN;
        if (import.meta.env.VITE_FIREBASE_PROJECT_ID) firebaseConfig.projectId = import.meta.env.VITE_FIREBASE_PROJECT_ID;
        if (import.meta.env.VITE_FIREBASE_STORAGE_BUCKET) firebaseConfig.storageBucket = import.meta.env.VITE_FIREBASE_STORAGE_BUCKET;
        if (import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID) firebaseConfig.messagingSenderId = import.meta.env.VITE_FIREBASE_MESSAGING_SENDER_ID;
        if (import.meta.env.VITE_FIREBASE_APP_ID) firebaseConfig.appId = import.meta.env.VITE_FIREBASE_APP_ID;
      }

      app = initializeApp(firebaseConfig);
      auth = getAuth(app);
      db = getFirestore(app);
      storage = getStorage(app);

      log('‚úÖ Firebase inicializado com sucesso', 'success');
    } catch (error) {
      log(`‚ùå Erro ao inicializar Firebase: ${error.message}`, 'error');
    }

    // Elementos DOM
    const authStatusEl = document.getElementById('auth-status');
    const cleanDataBtn = document.getElementById('clean-data-btn');
    const clearCacheBtn = document.getElementById('clear-cache-btn');
    const confirmationDialog = document.getElementById('confirmation-dialog');
    const selectedEnvDisplay = document.getElementById('selected-env-display');
    const confirmText = document.getElementById('confirm-text');
    const confirmationInput = document.getElementById('confirmation-input');
    const confirmBtn = document.getElementById('confirm-btn');
    const cancelBtn = document.getElementById('cancel-btn');
    const outputSection = document.getElementById('output-section');
    const outputEl = document.getElementById('output');
    const envOptions = document.querySelectorAll('.env-option');

    // Vari√°veis globais
    let selectedEnvironment = null;
    let currentUser = null;

    // Verificar status de autentica√ß√£o
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      if (user) {
        authStatusEl.className = 'status-indicator status-success';
        authStatusEl.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
            <polyline points="22 4 12 14.01 9 11.01"></polyline>
          </svg>
          <span>Autenticado como <strong>${user.email}</strong></span>
        `;
        cleanDataBtn.disabled = false;
      } else {
        authStatusEl.className = 'status-indicator status-error';
        authStatusEl.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          <span>N√£o autenticado. <a href="/" style="color: inherit; text-decoration: underline;">Fa√ßa login</a> para continuar.</span>
        `;
        cleanDataBtn.disabled = true;
      }
    });

    // Selecionar ambiente
    envOptions.forEach(option => {
      option.addEventListener('click', () => {
        envOptions.forEach(opt => opt.classList.remove('selected'));
        option.classList.add('selected');
        selectedEnvironment = option.dataset.env;
      });
    });

    // Bot√£o de limpar dados
    cleanDataBtn.addEventListener('click', () => {
      if (!selectedEnvironment) {
        log('‚ö†Ô∏è Selecione um ambiente antes de continuar', 'warning');
        return;
      }

      if (!currentUser) {
        log('‚ùå Voc√™ precisa estar autenticado para limpar dados', 'error');
        return;
      }

      // Mostrar di√°logo de confirma√ß√£o
      selectedEnvDisplay.textContent = selectedEnvironment;
      confirmText.textContent = selectedEnvironment;
      confirmationDialog.style.display = 'flex';
      confirmationInput.value = '';
      confirmBtn.disabled = true;
    });

    // Validar entrada de confirma√ß√£o
    confirmationInput.addEventListener('input', () => {
      const expectedValue = `CONFIRMAR-${selectedEnvironment}`;
      confirmBtn.disabled = confirmationInput.value !== expectedValue;
    });

    // Bot√£o de cancelar
    cancelBtn.addEventListener('click', () => {
      confirmationDialog.style.display = 'none';
    });

    // Bot√£o de confirmar limpeza
    confirmBtn.addEventListener('click', async () => {
      confirmationDialog.style.display = 'none';
      outputSection.classList.remove('hidden');
      await limparDados();
    });

    // Bot√£o de limpar cache local
    clearCacheBtn.addEventListener('click', () => {
      limparCacheLocal();
    });

    // Fun√ß√£o para limpar dados
    async function limparDados() {
      if (!currentUser) {
        log('‚ùå Voc√™ precisa estar autenticado para limpar dados', 'error');
        return;
      }

      log(`üîÑ Iniciando limpeza de dados no ambiente ${selectedEnvironment}...`, 'info');
      log(`üë§ Usu√°rio autenticado: ${currentUser.email}`, 'info');

      try {
        // Lista de cole√ß√µes para limpar
        const colecoes = [
          'users',
          'posts',
          'tournaments',
          'fishing_tournaments',
          'fishing_catches',
          'catches',
          'rankings',
          'comments',
          'likes'
        ];

        // Limpar cada cole√ß√£o
        for (const colecao of colecoes) {
          log(`üîÑ Limpando cole√ß√£o: ${colecao}...`, 'info');
          
          try {
            const snapshot = await getDocs(collection(db, colecao));
            
            if (snapshot.empty) {
              log(`‚ÑπÔ∏è Cole√ß√£o ${colecao} est√° vazia.`, 'info');
              continue;
            }

            // Criar lote para opera√ß√µes em massa
            let batch = writeBatch(db);
            let contador = 0;
            let totalDeletado = 0;

            // Adicionar cada documento ao lote para exclus√£o
            snapshot.docs.forEach((doc) => {
              batch.delete(doc.ref);
              contador++;
              totalDeletado++;

              // Firestore tem limite de 500 opera√ß√µes por lote
              if (contador >= 499) {
                log(`üîÑ Executando lote de ${contador} exclus√µes...`, 'info');
                batch.commit();
                batch = writeBatch(db);
                contador = 0;
              }
            });

            // Executar o lote final se houver opera√ß√µes pendentes
            if (contador > 0) {
              log(`üîÑ Executando lote final de ${contador} exclus√µes...`, 'info');
              await batch.commit();
            }

            log(`‚úÖ Cole√ß√£o ${colecao}: ${totalDeletado} documentos removidos.`, 'success');

            // Verificar se h√° mais documentos para excluir (recursivamente)
            if (totalDeletado >= 500) {
              log(`‚ÑπÔ∏è Poss√≠veis documentos restantes em ${colecao}. Continuando limpeza...`, 'info');
              // Chamar recursivamente para continuar a limpeza
              await limparColecao(colecao);
            }
          } catch (erro) {
            log(`‚ùå Erro ao limpar cole√ß√£o ${colecao}: ${erro.message}`, 'error');
          }
        }

        // Limpar tamb√©m o Storage
        log('üîÑ Iniciando limpeza do Storage...', 'info');
        try {
          const storageRef = ref(storage);
          
          // Listar todos os itens no storage
          const resultado = await listAll(storageRef);
          
          // Excluir todos os arquivos
          const promessasArquivos = resultado.items.map(item => {
            log(`üîÑ Excluindo arquivo: ${item.fullPath}`, 'info');
            return deleteObject(item);
          });
          
          // Processar recursivamente todas as pastas
          const promessasPastas = resultado.prefixes.map(pasta => limparPastaStorage(pasta));
          
          // Aguardar todas as exclus√µes
          await Promise.all([...promessasArquivos, ...promessasPastas]);
          
          log('‚úÖ Limpeza do Storage conclu√≠da.', 'success');
        } catch (erro) {
          log(`‚ùå Erro ao limpar Storage: ${erro.message}`, 'error');
        }

        // Limpar localStorage do navegador
        log('üîÑ Limpando localStorage do navegador...', 'info');
        localStorage.clear();
        log('‚úÖ localStorage limpo.', 'success');

        log('‚úÖ LIMPEZA DE DADOS CONCLU√çDA COM SUCESSO!', 'success');
        log('‚ÑπÔ∏è Recomendamos fazer logout e login novamente para atualizar o estado da aplica√ß√£o.', 'info');
      } catch (erro) {
        log(`‚ùå Erro durante a limpeza de dados: ${erro.message}`, 'error');
      }
    }

    // Fun√ß√£o auxiliar para limpar uma cole√ß√£o recursivamente
    async function limparColecao(nomeColecao) {
      const snapshot = await getDocs(collection(db, nomeColecao));
      
      if (snapshot.empty) {
        log(`‚úÖ Cole√ß√£o ${nomeColecao} completamente limpa.`, 'success');
        return;
      }

      let batch = writeBatch(db);
      let contador = 0;
      let totalDeletado = 0;

      snapshot.docs.forEach((doc) => {
        batch.delete(doc.ref);
        contador++;
        totalDeletado++;

        if (contador >= 499) {
          batch.commit();
          batch = writeBatch(db);
          contador = 0;
        }
      });

      if (contador > 0) {
        await batch.commit();
      }

      log(`üîÑ Cole√ß√£o ${nomeColecao}: mais ${totalDeletado} documentos removidos.`, 'info');

      // Continuar limpando se ainda houver documentos
      if (totalDeletado > 0) {
        await limparColecao(nomeColecao);
      }
    }

    // Fun√ß√£o auxiliar para limpar uma pasta do Storage recursivamente
    async function limparPastaStorage(pastaRef) {
      try {
        // Listar conte√∫do da pasta
        const resultado = await listAll(pastaRef);
        
        // Excluir todos os arquivos na pasta
        const promessasArquivos = resultado.items.map(item => {
          log(`üîÑ Excluindo arquivo: ${item.fullPath}`, 'info');
          return deleteObject(item);
        });
        
        // Processar recursivamente todas as subpastas
        const promessasPastas = resultado.prefixes.map(subpasta => limparPastaStorage(subpasta));
        
        // Aguardar todas as exclus√µes
        await Promise.all([...promessasArquivos, ...promessasPastas]);
        
        log(`‚úÖ Pasta ${pastaRef.fullPath} limpa.`, 'success');
      } catch (erro) {
        log(`‚ùå Erro ao limpar pasta ${pastaRef.fullPath}: ${erro.message}`, 'error');
      }
    }

    // Fun√ß√£o para limpar cache local
    function limparCacheLocal() {
      outputSection.classList.remove('hidden');
      log('üîÑ Limpando cache local...', 'info');
      
      try {
        // Limpar localStorage
        localStorage.clear();
        
        // Limpar cookies
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i];
          const eqPos = cookie.indexOf('=');
          const name = eqPos > -1 ? cookie.substr(0, eqPos).trim() : cookie.trim();
          document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
        }
        
        // Limpar cache se o navegador suportar
        if ('caches' in window) {
          caches.keys().then(function(names) {
            for (let name of names) {
              caches.delete(name);
            }
          });
          log('üîÑ Limpando cache do navegador...', 'info');
        }
        
        log('‚úÖ Cache local limpo com sucesso!', 'success');
        log('‚ÑπÔ∏è Recomendamos atualizar a p√°gina para aplicar as mudan√ßas.', 'info');
      } catch (e) {
        log(`‚ùå Erro ao limpar cache: ${e.message}`, 'error');
      }
    }

    // Fun√ß√£o para adicionar logs ao output
    function log(message, type = 'info') {
      const line = document.createElement('div');
      line.className = `output-line output-${type}`;
      line.textContent = message;
      outputEl.appendChild(line);
      outputEl.scrollTop = outputEl.scrollHeight;
      console.log(message);
    }
  </script>
</body>
</html>