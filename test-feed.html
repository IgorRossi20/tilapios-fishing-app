<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Teste Feed</title>
    <style>
      #mobile-helper {
        display: none;
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background-color: #3b82f6;
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        font-size: 14px;
        text-align: center;
        z-index: 9999;
        max-width: 90%;
        animation: bounce 2s infinite;
      }
      
      #mobile-helper a {
        color: white;
        text-decoration: underline;
        font-weight: bold;
      }
      
      @keyframes bounce {
        0%, 20%, 50%, 80%, 100% {transform: translateX(-50%) translateY(0);}
        40% {transform: translateX(-50%) translateY(-10px);}
        60% {transform: translateX(-50%) translateY(-5px);}
      }
    </style>
    <script>
      // Script para detectar problemas em dispositivos m√≥veis
      (function() {
        // Verificar se √© um dispositivo m√≥vel
        function isMobile() {
          return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Verificar tempo de carregamento
        window.addEventListener('load', function() {
          const startTime = parseInt(localStorage.getItem('tilapios_load_start') || '0');
          const loadTime = Date.now() - startTime;
          
          // Se o tempo de carregamento for muito longo (mais de 10 segundos) em dispositivo m√≥vel
          if (loadTime > 10000 && isMobile()) {
            localStorage.setItem('tilapios_slow_load', 'true');
          }
        });
      })();
    </script>
<body>
    <h1>Teste do Feed</h1>
    <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px;">
        <button onclick="addTestData()" style="background-color: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Adicionar Dados de Teste</button>
        <button onclick="checkData()" style="background-color: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Verificar Dados</button>
        <button onclick="clearCache()" style="background-color: #f87171; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Limpar Cache e Recarregar</button>
        <button onclick="testFirebase()" style="background-color: #8b5cf6; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Testar Firebase</button>
        <button onclick="checkDeviceInfo()" style="background-color: #f59e0b; color: white; border: none; padding: 8px 16px; border-radius: 4px;">Info do Dispositivo</button>
    </div>
    <div id="output" style="background-color: #f3f4f6; padding: 15px; border-radius: 8px; margin-top: 15px; font-family: monospace; white-space: pre-wrap;"></div>
    <div id="mobile-helper">
      Problemas para acessar? <a href="/mobile-debug.html">Clique aqui</a>
    </div>

    <script>
        function addTestData() {
            const testCatches = [
                {
                    id: 'test_1',
                    species: 'Dourado',
                    weight: 4.5,
                    location: 'Rio Paran√°',
                    userName: 'Jo√£o Silva',
                    registeredAt: new Date().toISOString(),
                    photo: null
                },
                {
                    id: 'test_2', 
                    species: 'Pintado',
                    weight: 8.2,
                    location: 'Rio Tiet√™',
                    userName: 'Maria Santos',
                    registeredAt: new Date(Date.now() - 3600000).toISOString(),
                    photo: null
                },
                {
                    id: 'test_3',
                    species: 'Pacu',
                    weight: 2.1,
                    location: 'Lago dos Patos',
                    userName: 'Pedro Costa',
                    registeredAt: new Date(Date.now() - 7200000).toISOString(),
                    photo: null
                }
            ];
            
            localStorage.setItem('fishing_catches', JSON.stringify(testCatches));
            document.getElementById('output').innerHTML = '‚úÖ Dados de teste adicionados!';
        }
        
        function checkData() {
            const data = JSON.parse(localStorage.getItem('fishing_catches') || '[]');
            document.getElementById('output').innerHTML = `üìä Total de capturas: ${data.length}<br><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        function clearCache() {
            // Limpar dados do localStorage
            const keysToKeep = [];
            const totalKeys = localStorage.length;
            
            // Mostrar mensagem de limpeza
            document.getElementById('output').innerHTML = 'üßπ Limpando cache...';
            
            // Limpar todos os itens do localStorage exceto os que queremos manter
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (!keysToKeep.includes(key)) {
                    localStorage.removeItem(key);
                    i--; // Ajustar o √≠ndice ap√≥s remover um item
                }
            }
            
            // Limpar cookies relacionados √† aplica√ß√£o
            document.cookie.split(';').forEach(function(c) {
                document.cookie = c.trim().split('=')[0] + '=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/';
            });
            
            // Atualizar mensagem
            document.getElementById('output').innerHTML = `üßπ Cache limpo! Removidos ${totalKeys - keysToKeep.length} itens do localStorage e todos os cookies.`;
            
            // Redirecionar ap√≥s 2 segundos
            setTimeout(function() {
                window.location.href = '/';
            }, 2000);
        }
        
        function testFirebase() {
            const output = document.getElementById('output');
            output.innerHTML = 'üîÑ Testando conex√£o com Firebase...';
            
            // Carregar o script de diagn√≥stico do Firebase
            const script = document.createElement('script');
            script.src = '/firebase-check.js';
            script.onload = function() {
                // O script firebase-check.js deve definir uma fun√ß√£o global runFirebaseCheck
                if (typeof window.runFirebaseCheck === 'function') {
                    window.runFirebaseCheck(function(results) {
                        output.innerHTML = results;
                    });
                } else {
                    output.innerHTML = '‚ùå Erro: Script de diagn√≥stico do Firebase n√£o encontrado ou n√£o carregou corretamente.';
                }
            };
            script.onerror = function() {
                output.innerHTML = '‚ùå Erro: N√£o foi poss√≠vel carregar o script de diagn√≥stico do Firebase.';
            };
            document.body.appendChild(script);
        }
        
        function checkDeviceInfo() {
            const output = document.getElementById('output');
            
            // Coletar informa√ß√µes do dispositivo
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                vendor: navigator.vendor,
                language: navigator.language,
                cookiesEnabled: navigator.cookieEnabled,
                online: navigator.onLine,
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                pixelRatio: window.devicePixelRatio,
                viewportWidth: window.innerWidth,
                viewportHeight: window.innerHeight,
                localStorage: !!window.localStorage,
                sessionStorage: !!window.sessionStorage,
                indexedDB: !!window.indexedDB,
                serviceWorker: !!navigator.serviceWorker,
                connection: navigator.connection ? {
                    effectiveType: navigator.connection.effectiveType,
                    downlink: navigator.connection.downlink,
                    rtt: navigator.connection.rtt,
                    saveData: navigator.connection.saveData
                } : 'N√£o dispon√≠vel'
            };
            
            // Verificar se √© um dispositivo m√≥vel
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            // Formatar a sa√≠da
            let html = `<h3>üì± Informa√ß√µes do Dispositivo</h3>
<div style="background-color: ${isMobile ? '#fef3c7' : '#dbeafe'}; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
  <strong>Tipo de Dispositivo:</strong> ${isMobile ? 'üì± M√≥vel' : 'üíª Desktop'}
</div>

<h4>Navegador e Sistema</h4>
<ul style="list-style-type: none; padding-left: 0;">
  <li><strong>User Agent:</strong> ${info.userAgent}</li>
  <li><strong>Plataforma:</strong> ${info.platform}</li>
  <li><strong>Fabricante:</strong> ${info.vendor || 'N√£o dispon√≠vel'}</li>
  <li><strong>Idioma:</strong> ${info.language}</li>
</ul>

<h4>Tela e Viewport</h4>
<ul style="list-style-type: none; padding-left: 0;">
  <li><strong>Resolu√ß√£o da Tela:</strong> ${info.screenWidth} x ${info.screenHeight}</li>
  <li><strong>Tamanho do Viewport:</strong> ${info.viewportWidth} x ${info.viewportHeight}</li>
  <li><strong>Pixel Ratio:</strong> ${info.pixelRatio}</li>
</ul>

<h4>Recursos do Navegador</h4>
<ul style="list-style-type: none; padding-left: 0;">
  <li><strong>Cookies Habilitados:</strong> ${info.cookiesEnabled ? '‚úÖ Sim' : '‚ùå N√£o'}</li>
  <li><strong>Online:</strong> ${info.online ? '‚úÖ Sim' : '‚ùå N√£o'}</li>
  <li><strong>LocalStorage:</strong> ${info.localStorage ? '‚úÖ Dispon√≠vel' : '‚ùå Indispon√≠vel'}</li>
  <li><strong>SessionStorage:</strong> ${info.sessionStorage ? '‚úÖ Dispon√≠vel' : '‚ùå Indispon√≠vel'}</li>
  <li><strong>IndexedDB:</strong> ${info.indexedDB ? '‚úÖ Dispon√≠vel' : '‚ùå Indispon√≠vel'}</li>
  <li><strong>Service Worker:</strong> ${info.serviceWorker ? '‚úÖ Suportado' : '‚ùå N√£o suportado'}</li>
</ul>`;
            
            // Adicionar informa√ß√µes de conex√£o se dispon√≠veis
            if (info.connection !== 'N√£o dispon√≠vel') {
                html += `
<h4>Informa√ß√µes de Conex√£o</h4>
<ul style="list-style-type: none; padding-left: 0;">
  <li><strong>Tipo de Conex√£o:</strong> ${info.connection.effectiveType || 'Desconhecido'}</li>
  <li><strong>Downlink:</strong> ${info.connection.downlink || 'Desconhecido'} Mbps</li>
  <li><strong>RTT:</strong> ${info.connection.rtt || 'Desconhecido'} ms</li>
  <li><strong>Modo Economia de Dados:</strong> ${info.connection.saveData ? '‚úÖ Ativado' : '‚ùå Desativado'}</li>
</ul>`;
            }
            
            // Adicionar bot√£o para copiar informa√ß√µes
            html += `
<button onclick="copyDeviceInfo()" style="background-color: #6366f1; color: white; border: none; padding: 8px 16px; border-radius: 4px; margin-top: 15px;">üìã Copiar Informa√ß√µes</button>`;
            
            // Adicionar fun√ß√£o para copiar informa√ß√µes
            window.copyDeviceInfo = function() {
                const plainText = `Informa√ß√µes do Dispositivo:\n\n` +
                    `Tipo de Dispositivo: ${isMobile ? 'M√≥vel' : 'Desktop'}\n` +
                    `User Agent: ${info.userAgent}\n` +
                    `Plataforma: ${info.platform}\n` +
                    `Resolu√ß√£o da Tela: ${info.screenWidth} x ${info.screenHeight}\n` +
                    `Tamanho do Viewport: ${info.viewportWidth} x ${info.viewportHeight}\n` +
                    `Pixel Ratio: ${info.pixelRatio}\n` +
                    `Cookies Habilitados: ${info.cookiesEnabled ? 'Sim' : 'N√£o'}\n` +
                    `Online: ${info.online ? 'Sim' : 'N√£o'}\n` +
                    `LocalStorage: ${info.localStorage ? 'Dispon√≠vel' : 'Indispon√≠vel'}\n` +
                    `SessionStorage: ${info.sessionStorage ? 'Dispon√≠vel' : 'Indispon√≠vel'}\n` +
                    `IndexedDB: ${info.indexedDB ? 'Dispon√≠vel' : 'Indispon√≠vel'}\n` +
                    `Service Worker: ${info.serviceWorker ? 'Suportado' : 'N√£o suportado'}\n`;
                
                navigator.clipboard.writeText(plainText)
                    .then(() => {
                        alert('Informa√ß√µes copiadas para a √°rea de transfer√™ncia!');
                    })
                    .catch(err => {
                        console.error('Erro ao copiar: ', err);
                        alert('N√£o foi poss√≠vel copiar as informa√ß√µes. Erro: ' + err);
                    });
            };
            
            output.innerHTML = html;
        }
    </script>
    
    <script>
      // Script para exibir o helper em dispositivos m√≥veis ap√≥s um tempo
      (function() {
        function isMobile() {
          return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }
        
        if (isMobile()) {
          // Exibir o helper ap√≥s 5 segundos em dispositivos m√≥veis
          setTimeout(function() {
            var helper = document.getElementById('mobile-helper');
            if (helper) helper.style.display = 'block';
            
            // Esconder ap√≥s 15 segundos se n√£o houver intera√ß√£o
            setTimeout(function() {
              if (helper && !helper.dataset.clicked) helper.style.display = 'none';
            }, 15000);
          }, 5000);
        }
      })();
    </script>
</body>
</html>