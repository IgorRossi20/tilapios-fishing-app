<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug SincronizaÃ§Ã£o</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .warning { background: #fff3e0; color: #ef6c00; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ” Debug de SincronizaÃ§Ã£o</h1>
    
    <div>
        <button onclick="checkLocalStorage()">ğŸ“¦ Verificar localStorage</button>
        <button onclick="checkOnlineStatus()">ğŸŒ Status Online</button>
        <button onclick="simulateSync()">ğŸ”„ Simular SincronizaÃ§Ã£o</button>
        <button onclick="clearLogs()">ğŸ§¹ Limpar Logs</button>
    </div>
    
    <div id="logs"></div>
    
    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs')
            const logDiv = document.createElement('div')
            logDiv.className = `log ${type}`
            logDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`
            logsDiv.appendChild(logDiv)
            logsDiv.scrollTop = logsDiv.scrollHeight
        }
        
        function checkLocalStorage() {
            log('ğŸ” Verificando localStorage...', 'info')
            
            const keys = [
                'pending_catches',
                'all_tournaments',
                'all_catches'
            ]
            
            keys.forEach(key => {
                const data = localStorage.getItem(key)
                if (data) {
                    try {
                        const parsed = JSON.parse(data)
                        log(`ğŸ“¦ ${key}: ${Array.isArray(parsed) ? parsed.length : 'objeto'} itens`, 'success')
                    } catch (e) {
                        log(`âŒ ${key}: erro ao parsear JSON`, 'error')
                    }
                } else {
                    log(`ğŸ“¦ ${key}: vazio`, 'warning')
                }
            })
            
            // Verificar chaves de usuÃ¡rio especÃ­fico
            Object.keys(localStorage).forEach(key => {
                if (key.includes('user_catches_') || key.includes('user_tournaments_')) {
                    const data = localStorage.getItem(key)
                    try {
                        const parsed = JSON.parse(data)
                        log(`ğŸ‘¤ ${key}: ${Array.isArray(parsed) ? parsed.length : 'objeto'} itens`, 'success')
                    } catch (e) {
                        log(`âŒ ${key}: erro ao parsear JSON`, 'error')
                    }
                }
            })
        }
        
        function checkOnlineStatus() {
            log('ğŸŒ Verificando status de conectividade...', 'info')
            log(`ğŸ“¡ Navigator.onLine: ${navigator.onLine}`, navigator.onLine ? 'success' : 'error')
            log(`ğŸ”— URL atual: ${window.location.href}`, 'info')
            
            // Testar conectividade com um ping simples
            fetch('/favicon.ico')
                .then(() => log('âœ… Conectividade local OK', 'success'))
                .catch(() => log('âŒ Problema de conectividade local', 'error'))
        }
        
        function simulateSync() {
            log('ğŸ”„ Simulando processo de sincronizaÃ§Ã£o...', 'info')
            
            // Simular verificaÃ§Ã£o de autenticaÃ§Ã£o
            log('ğŸ‘¤ Verificando autenticaÃ§Ã£o...', 'info')
            setTimeout(() => {
                log('âœ… UsuÃ¡rio autenticado (simulado)', 'success')
                
                // Simular verificaÃ§Ã£o de dados pendentes
                log('ğŸ“‹ Verificando dados pendentes...', 'info')
                setTimeout(() => {
                    const pendingCatches = localStorage.getItem('pending_catches')
                    if (pendingCatches) {
                        try {
                            const parsed = JSON.parse(pendingCatches)
                            log(`ğŸ“¤ ${parsed.length} capturas pendentes encontradas`, 'warning')
                        } catch (e) {
                            log('âŒ Erro ao ler capturas pendentes', 'error')
                        }
                    } else {
                        log('âœ… Nenhuma captura pendente', 'success')
                    }
                    
                    // Simular sincronizaÃ§Ã£o
                    log('ğŸ”„ Iniciando sincronizaÃ§Ã£o com Firestore...', 'info')
                    setTimeout(() => {
                        log('âœ… SincronizaÃ§Ã£o simulada concluÃ­da', 'success')
                    }, 1000)
                }, 500)
            }, 500)
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = ''
        }
        
        // Log inicial
        log('ğŸš€ Debug de sincronizaÃ§Ã£o iniciado', 'success')
        log('ğŸ’¡ Use os botÃµes acima para testar diferentes aspectos da sincronizaÃ§Ã£o', 'info')
    </script>
</body>
</html>