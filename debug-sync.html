<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Sincronização</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .warning { background: #fff3e0; color: #ef6c00; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>🔍 Debug de Sincronização</h1>
    
    <div>
        <button onclick="checkLocalStorage()">📦 Verificar localStorage</button>
        <button onclick="checkOnlineStatus()">🌐 Status Online</button>
        <button onclick="simulateSync()">🔄 Simular Sincronização</button>
        <button onclick="clearLogs()">🧹 Limpar Logs</button>
    </div>
    
    <div id="logs"></div>
    
    <script>
        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs')
            const logDiv = document.createElement('div')
            logDiv.className = `log ${type}`
            logDiv.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`
            logsDiv.appendChild(logDiv)
            logsDiv.scrollTop = logsDiv.scrollHeight
        }
        
        function checkLocalStorage() {
            log('🔍 Verificando localStorage...', 'info')
            
            const keys = [
                'pending_catches',
                'all_tournaments',
                'all_catches'
            ]
            
            keys.forEach(key => {
                const data = localStorage.getItem(key)
                if (data) {
                    try {
                        const parsed = JSON.parse(data)
                        log(`📦 ${key}: ${Array.isArray(parsed) ? parsed.length : 'objeto'} itens`, 'success')
                    } catch (e) {
                        log(`❌ ${key}: erro ao parsear JSON`, 'error')
                    }
                } else {
                    log(`📦 ${key}: vazio`, 'warning')
                }
            })
            
            // Verificar chaves de usuário específico
            Object.keys(localStorage).forEach(key => {
                if (key.includes('user_catches_') || key.includes('user_tournaments_')) {
                    const data = localStorage.getItem(key)
                    try {
                        const parsed = JSON.parse(data)
                        log(`👤 ${key}: ${Array.isArray(parsed) ? parsed.length : 'objeto'} itens`, 'success')
                    } catch (e) {
                        log(`❌ ${key}: erro ao parsear JSON`, 'error')
                    }
                }
            })
        }
        
        function checkOnlineStatus() {
            log('🌐 Verificando status de conectividade...', 'info')
            log(`📡 Navigator.onLine: ${navigator.onLine}`, navigator.onLine ? 'success' : 'error')
            log(`🔗 URL atual: ${window.location.href}`, 'info')
            
            // Testar conectividade com um ping simples
            fetch('/favicon.ico')
                .then(() => log('✅ Conectividade local OK', 'success'))
                .catch(() => log('❌ Problema de conectividade local', 'error'))
        }
        
        function simulateSync() {
            log('🔄 Simulando processo de sincronização...', 'info')
            
            // Simular verificação de autenticação
            log('👤 Verificando autenticação...', 'info')
            setTimeout(() => {
                log('✅ Usuário autenticado (simulado)', 'success')
                
                // Simular verificação de dados pendentes
                log('📋 Verificando dados pendentes...', 'info')
                setTimeout(() => {
                    const pendingCatches = localStorage.getItem('pending_catches')
                    if (pendingCatches) {
                        try {
                            const parsed = JSON.parse(pendingCatches)
                            log(`📤 ${parsed.length} capturas pendentes encontradas`, 'warning')
                        } catch (e) {
                            log('❌ Erro ao ler capturas pendentes', 'error')
                        }
                    } else {
                        log('✅ Nenhuma captura pendente', 'success')
                    }
                    
                    // Simular sincronização
                    log('🔄 Iniciando sincronização com Firestore...', 'info')
                    setTimeout(() => {
                        log('✅ Sincronização simulada concluída', 'success')
                    }, 1000)
                }, 500)
            }, 500)
        }
        
        function clearLogs() {
            document.getElementById('logs').innerHTML = ''
        }
        
        // Log inicial
        log('🚀 Debug de sincronização iniciado', 'success')
        log('💡 Use os botões acima para testar diferentes aspectos da sincronização', 'info')
    </script>
</body>
</html>